openapi: 3.0.0
x-stoplight:
  id: zk30b9144hq8c
info:
  version: 1.0.0
  title: Swappily OpenAPI 3.0
  description: API for managing exchange of goods between users.
  license:
    name: MIT
servers:
  - url: 'http://localhost:8080/api/v1'
    description: Localhost
paths:
  /authentications:
    post:
      description: Authenticate a user
      summary: Authenticate a user and return a token.
      responses:
        '200':
          description: Token created
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    description: True if the authentication is a success
                  token:
                    type: string
                    description: JWT token
        '401':
          description: Unauthorized. Invalid credential
      requestBody:
        description: The username and password must be passed in the Body
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - username
                - password
              properties:
                username:
                  type: string
                  description: Username of the user
                password:
                  type: string
                  description: Password of the user
      x-stoplight:
        id: y6lnq6qeeuh6y
  /users:
    post:
      description: Creates a new user in the system.
      summary: Register a new user.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/User'
      responses:
        '201':
          description: User created. Link in the Location header
          headers:
            Location:
              schema:
                type: string
              description: Link to the newly created user.
        '400':
          description: Bad request. The input is not correct
      x-stoplight:
        id: fjxu6ek9e7nty
    get:
      description: Get all the users. It is possible to show users by their username.
      summary: View all users or filtered by username.
      parameters:
        - in: query
          name: username
          schema:
            type: string
          required: false
      responses:
        '200':
          description: Collection of users
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
        '404':
          description: User not found
        '500':
          description: Server error
      x-stoplight:
        id: sfcm9n8d5ek6u
  '/users/{userId}':
    get:
      description: Gets a user by ID.
      summary: View a user
      parameters:
        - in: path
          name: userId
          schema:
            type: string
          required: true
      responses:
        '200':
          description: User found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '404':
          description: User not found
        '500':
          description: Server error
      x-stoplight:
        id: 9rbzpnod84p84
    delete:
      description: Delete a user
      summary: Delete a user.
      security:
        - TokenQueryAuth: []
        - accessTokenHeader: []
      parameters:
        - in: path
          name: userId
          schema:
            type: string
          required: true
      responses:
        '204':
          description: User deleted
        '404':
          description: User not found
        '500':
          description: Server error
      x-stoplight:
        id: 9uo75co78uiyd
    put:
      description: Updates an existing user.
      summary: Update an existing user
      security:
        - TokenQueryAuth: []
        - accessTokenHeader: []
      parameters:
        - in: path
          name: userId
          schema:
            type: string
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/User'
      responses:
        '200':
          description: User updated
        '404':
          description: User not found
      x-stoplight:
        id: 68pk8lzqlqvcy
  /listings:
    post:
      description: Creates a new listing.
      summary: Create a new listing
      security:
        - TokenQueryAuth: []
        - accessTokenHeader: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Listing'
      responses:
        '201':
          description: Listing created. Link in the Location header
          headers:
            Location:
              schema:
                type: string
              description: Link to the newly created listing.
        '400':
          description: Bad request.
        '403':
          description: Not authorized.
        '500':
          description: Internal server error.
      x-stoplight:
        id: v25x1q7izo1kb
    get:
      description: 'Gets the list of listings. It is possible to show the listing by their title or filtered by favorites, followed or status.'
      summary: View all listings or filtered listings.
      parameters:
        - in: query
          name: title
          schema:
            type: string
        - in: query
          name: status
          schema:
            type: array
            items:
              type: string
            enum:
              - As new
              - Good
              - Ok
              - Not Good
        - in: query
          name: favorite
          schema:
            type: boolean
        - in: query
          name: followed
          schema:
            type: boolean
      responses:
        '200':
          description: Collection of listings
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Listing'
        '404':
          description: Not found
        '500':
          description: Server error
      x-stoplight:
        id: ptsqe6xnbvb33
  '/listings/{userId}/favourites':
    get:
      description: Gets the listings selected as favourites by a user.
      summary: View all favourite listings of a user.
      security:
        - TokenQueryAuth: []
        - accessTokenHeader: []
      parameters:
        - in: path
          name: userId
          schema:
            type: string
          required: true
      responses:
        '200':
          description: Collection of favourite listings
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Listing'
        '404':
          description: User not found
        '500':
          description: Server error
      x-stoplight:
        id: 3j8d7k2l4m5n9
  '/listings/{userId}/following':
    get:
      description: Gets the listing of the user following.
      summary: View all listings of the users followed by a user.
      security:
        - TokenQueryAuth: []
        - accessTokenHeader: []
      parameters:
        - in: path
          name: userId
          schema:
            type: string
          required: true
      responses:
        '200':
          description: Collection of listings
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Listing'
        '404':
          description: User not found
        '500':
          description: Server error
      x-stoplight:
        id: 1a2b3c4d5e6f7
  '/listings/{listingId}':
    get:
      description: Gets a listing by ID.
      summary: View a listing
      parameters:
        - in: path
          name: listingId
          schema:
            type: string
          required: true
      responses:
        '200':
          description: Listing found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Listing'
        '404':
          description: Listing not found
      x-stoplight:
        id: l18m3t6a2a81d
    delete:
      description: Deletes a listing by ID.
      summary: Delete a listing
      security:
        - TokenQueryAuth: []
        - accessTokenHeader: []
      parameters:
        - in: path
          name: listingId
          schema:
            type: string
          required: true
      responses:
        '204':
          description: Listing deleted
        '403':
          description: The user does not have the authorization
        '404':
          description: Listing not found
        '500':
          description: Internal server error
      x-stoplight:
        id: hhbfxz19wavn5
    put:
      description: Updates an existing listing.
      summary: Update an existing listing
      security:
        - TokenQueryAuth: []
        - accessTokenHeader: []
      parameters:
        - in: path
          name: listingId
          schema:
            type: string
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Listing'
      responses:
        '200':
          description: Listing modified
        '404':
          description: Listing not found
      x-stoplight:
        id: 9tkvaq3k652dv
  /exchange:
    get:
      description: Gets the list of exchanges. It is possible to show the exchanges by their status.
      summary: View all exchanges or filtered exchanges.
      parameters:
        - in: query
          name: status
          schema:
            type: array
            items:
              type: string
            enum:
              - pending
              - accepted
              - rejected
      responses:
        '200':
          description: Collection of exchanges
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Exchange'
        '404':
          description: Exchanges not found
      x-stoplight:
        id: pz72gepzxjqm7
  '/exchange/listing/{listingId}':
    post:
      description: Creates a new exchange.
      summary: Exchange an object
      security:
        - TokenQueryAuth: []
        - accessTokenHeader: []
      parameters:
        - in: path
          name: listingId
          schema:
            type: string
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Exchange'
      responses:
        '201':
          description: Exchange created. Link in the Location header
          headers:
            Location:
              schema:
                type: string
              description: Link to the newly created exchange.
      x-stoplight:
        id: rz90tzdtusqj1
  '/exchange/{exchangeId}':
    get:
      description: Gets an exchange by ID.
      summary: View an exchange
      parameters:
        - in: path
          name: exchangeId
          schema:
            type: string
          required: true
      responses:
        '200':
          description: Exchange found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Exchange'
        '404':
          description: Exchange not found
      x-stoplight:
        id: x0a2y30d3av84
    put:
      description: Modify an exchange
      summary: Modify an exchange
      security:
        - TokenQueryAuth: []
        - accessTokenHeader: []
      parameters:
        - in: path
          name: exchangeId
          schema:
            type: string
          required: true
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Exchange'
      responses:
        '200':
          description: Exchange modified
        '404':
          description: Exchange not found
      x-stoplight:
        id: v9li0ergdbuon
    delete:
      description: Deleting an existing exchange
      summary: Deleting an exchange
      parameters:
        - in: path
          name: exchangeId
          schema:
            type: string
          required: true
      security:
        - TokenQueryAuth: []
        - accessTokenHeader: []
      responses:
        '204':
          description: Exchange deleted
        '404':
          description: Exchange not found
      x-stoplight:
        id: u8k57cg9ri9a0
  /review:
    post:
      description: Create a new review
      summary: Write a review
      security:
        - TokenQueryAuth: []
        - accessTokenHeader: []
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/Review'
      responses:
        '201':
          description: Review created. The header contains a link to the newly created review
          headers:
            Location:
              schema:
                type: string
              description: Link to the newly created review.
        '400':
          description: Bad request. The input is not correct
        '500':
          description: Server error
      x-stoplight:
        id: hs9crfslb2mxw
  '/review/{reviewId}':
    delete:
      description: The user deletes one of his reviews
      summary: Deleting a review
      security:
        - TokenQueryAuth: []
        - accessTokenHeader: []
      parameters:
        - in: path
          name: reviewId
          schema:
            type: string
          required: true
      responses:
        '204':
          description: Review deleted
        '403':
          description: This user does not have the authorization
        '404':
          description: Review not found
      x-stoplight:
        id: rkw39va24nc9t
  '/review/reviewee/{revieweeId}':
    get:
      description: Get all the reviews of one user
      summary: Reviews of a user
      parameters:
        - in: header
          name: authenticate
          schema:
            type: string
        - in: path
          name: revieweeId
          schema:
            type: string
          required: true
      responses:
        '200':
          description: Reviews found
          content:
            application/json:
              schema:
                type: array
                items: 
                  $ref: '#/components/schemas/Review'
        '404':
          description: Not found
        '500':
          description: Server error
      x-stoplight:
        id: 2y39wyme3ew7d
  /report:
    post:
      description: Creating a new report
      summary: Create a report
      security:
        - TokenQueryAuth: []
        - accessTokenHeader: []
      requestBody:
        content:
          application/json:
            schema:
              type: object
              required:
                - reporterId
                - text
              properties:
                reporterId:
                  type: string
                  description: ID of the user creating the report
                reporteeId:
                  type: string
                  description: ID of the user being reported (optional)
                listingId:
                  type: string
                  description: ID of the listing being reported (optional)
                text:
                  type: string
                  description: Textual description of the report
                  maxLength: 2000
      responses:
        '201':
          description: Report created successfully
          headers:
            Location:
              schema:
                type: string
              description: Link to the newly created report
        '400':
          description: Bad request. Missing required fields
        '404':
          description: User or listing not found
        '500':
          description: Server error
      x-stoplight:
        id: uoper50c9xunx
components:
  securitySchemes:
    accessTokenHeader:
      description: The API authentication. The API key must be a valid JWT token.
      type: apiKey
      in: header
      name: x-access-token
    TokenQueryAuth:
      description: The API authentication. The API must be a valid JWT token
      type: apiKey
      in: query
      name: token
  schemas:
    User:
      type: object
      required:
        - name
        - surname
        - username
        - email
        - password
        - usertype
      properties:
        userId:
          type: string
          description: Unique identifier for the user
        name:
          type: string
          description: Name of the user
        surname:
          type: string
          description: Surname of the user
        username:
          type: string
          minLength: 3
          maxLength: 20
          description: Username of the user
        email:
          type: string
          format: email
          description: Email address of the user
        password:
          type: string
          minLength: 8
          description: Password of the user
        usertype:
          type: string
          enum: [user, operator]
          description: Indicates whether the user is a normal user or an operator
        phone:
          type: string
          description: Phone number of the user
        favorite:
          type: array
          description: List of favorite listings of the user
          items:
            type: string
          default: []
        followed:
          type: array
          items:
            type: string
          description: List of followed users
          default: []
        n_followed:
          type: integer
          description: Number of users followed by the user
          default: 0
        followers:
          type: array
          description: List of followers of the user 
          items:
            type: string
          default: []
        n_followers:
          type: integer
          description: Number of followers of the user
          default: 0
        blocklist:
          type: array
          description: List of users blocked by the user
          items:
            type: string
          default: []
        n_exchanges:
          type: integer
          description: Number of exchanges made by the user
          default: 0
      x-stoplight:
        id: jlrd3bu8k2a0d
    Listing:
      type: object
      required:
        - title
        - userId
        - description
        - status
        - available
      properties:
        listingId:
          type: string
          description: Unique identifier for the listing
        title:
          type: string
          description: Title of the listing
        userId:
          type: string
          description: ID of the user who created the listing
        username:
          type: string
          description: Username of the creator of the listing
        description:
          type: string
          description: Description of the listing
        status:
          type: string
          enum:
            - As new
            - Good
            - Ok
            - Not Good
          description: Physical condition of the object
        available:
          type: boolean
          description: Availability of the object
          default: true
      x-stoplight:
        id: 221d3mf53a0ez
    Exchange:
      type: object
      required:
        - sender
        - receiver
        - offeredListing
        - requestedListing
        - status
      properties:
        exchangeId:
          type: string
          description: Unique identifier for the exchange
        sender:
          type: string
          description: ID of the user who initiated the exchange
        receiver:
          type: string
          description: ID of the user who received the exchange request
        offeredListing:
          type: string
          description: ID of the listing offered in exchange
        requestedListing:
          type: string
          description: ID of the listing requested in exchange
        status:
          type: string
          enum:
            - pending
            - accepted
            - rejected
          description: Status of the exchange
          default: pending
        date:
          type: string
          format: date-time
          description: Date when the exchange was created
      x-stoplight:
        id: wv6hktdojgdt4
    Review:
      type: object
      required:
        - revieweeId
        - reviewerId
        - text
      properties:
        reviewId:
          type: string
          description: Unique identifier for the review
        reviewerId:
          type: string
          description: ID of the user writing the review
        revieweeId:
          type: string
          description: ID of the user being reviewed
        text:
          type: string
          description: Body of the review
      x-stoplight:
        id: f7t8et4y946gv
    Report:
      type: object
      required:
        - reporterId
        - text
      properties:
        reportId:
          type: string
          description: Unique identifier for the report
        reporterId:
          type: string
          description: ID of the user creating the report
        reporteeId:
          type: string
          description: ID of the user being reported (optional)
        listingId:
          type: string
          description: ID of the listing being reported (optional)
        text:
          type: string
          description: Textual description of the report
          maxLength: 2000
      x-stoplight:
        id: ao0e8ptncc0y7